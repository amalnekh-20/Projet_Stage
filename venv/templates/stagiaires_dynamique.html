<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Stagiaires par Fili√®re et Promotion</title>
  <link rel="stylesheet" href="/static/stagiaire.css">

</head>
<body>
   <header>
    <div class="header-left">
      <div class="header__logo-text">IFFTS</div>
    </div>
    <nav class="header__nav">
      <a href="/">Acceuil</a>
      <a href="/logout">D√©connexion</a>

    </nav>
  </header>
  <div style="display: flex; justify-content: space-between;  margin: 20px 20px;">
    <h2>üîç Consulter les stagiaires</h2>
  
    <button class="add-stagiaire-button">
      <a href="/addStagiaire">
        Ajouter Stagiaire
      </a> 
    </button>

  </div>


 <label for="promotionSelect">Promotion :</label>
<select id="promotionSelect" class="filter-select" disabled>
  <option value="">-- Choisir une promotion --</option>
</select>

<div class="stagiaire-list" id="stagiaireList">
  <p>Veuillez choisir une promotion pour afficher les stagiaires.</p>
</div>


  <script>
  const promotionSelect = document.getElementById('promotionSelect');
  const stagiaireList = document.getElementById('stagiaireList');

  //  Charger directement les promotions de la fili√®re du professeur connect√©
  window.addEventListener('DOMContentLoaded', () => {
    fetch('/api/promotions')   // ‚ö†Ô∏è cette route doit renvoyer seulement les promotions de la fili√®re du prof
      .then(res => res.json())
      .then(promotions => {
        if (promotions.length === 0) {
          promotionSelect.innerHTML = '<option>Aucune promotion trouv√©e</option>';
          promotionSelect.disabled = true;
          stagiaireList.innerHTML = "<p>Aucun stagiaire trouv√©.</p>";
          return;
        }

        promotionSelect.innerHTML = '<option value="">-- Choisir une promotion --</option>';
        promotions.forEach(promo => {
          const opt = document.createElement('option');
          opt.value = promo.id;
          opt.textContent = promo.nom;
          promotionSelect.appendChild(opt);
        });
        promotionSelect.disabled = false;
      });
  });

  // Affichage des stagiaires filtr√©s par promotion
  promotionSelect.addEventListener('change', () => {
    const promoId = promotionSelect.value;
    if (!promoId) return;

    stagiaireList.innerHTML = "<p>Chargement des stagiaires...</p>";

    fetch(`/api/stagiaires/${promoId}`)
      .then(res => res.json())
      .then(data => {
        if (data.length === 0) {
          stagiaireList.innerHTML = "<p>Aucun stagiaire trouv√© pour cette promotion.</p>";
          return;
        }

        stagiaireList.innerHTML = generateTable(data, "Liste des stagiaires");
      });
  });

  //  Fonction utilitaire : g√©n√®re le tableau HTML
  function generateTable(data, titre) {
    let table = `<h3>${titre}</h3>
    <table border="1" style="width:100%; border-collapse:collapse">
      <thead>
        <tr>
          <th>Nom</th><th>Pr√©nom</th><th>CINE</th>
          <th>T√©l√©phone</th><th>Email</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>`;

    data.forEach(s => {
      table += `<tr>
        <td>${s.nom}</td>
        <td>${s.prenom}</td>
        <td>${s.cine}</td>
        <td>${s.telephone}</td>
        <td>${s.email}</td>
        <td>
          <a href="/deleteStagiaire/${s.id_stagiaire}" class="action-btn delete-btn"
              onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer ce stagiaire ?');">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
              </svg>
          </a>
          &nbsp;&nbsp;
          <a href="/editStagiaire/${s.id_stagiaire}" class="action-btn edit-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
              </svg>
          </a>
        </td>
      </tr>`;
    });

    table += `</tbody></table>`;
    return table;
  }
</script>

</body>
</html>
